<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TechnopDive Projects</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Roboto&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f2027;
      --bg-alt: #203a43;
      --card: rgba(255, 255, 255, 0.05);
      --text: #fff;
      --link: #00ffff;
    }

    [data-theme="light"] {
      --bg: #f0f0f0;
      --bg-alt: #fff;
      --card: #ffffff;
      --text: #111;
      --link: #007acc;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }

    header {
      padding: 2rem;
      text-align: center;
      background-color: var(--bg-alt);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: relative;
    }

    header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      margin: 0;
    }

    header p {
      color: var(--text);
      opacity: 0.7;
      font-size: 1.1rem;
    }

    .toggle {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: none;
      border: 2px solid var(--text);
      color: var(--text);
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: 8px;
      user-select: none;
    }

    /* Controls Container */
    #controls {
      max-width: 1200px;
      margin: 1rem auto 0 auto;
      padding: 0 1rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      align-items: center;
    }

    #controls > * {
      font-size: 1rem;
    }

    /* Grid/List toggle buttons */
    #viewToggle button {
      background: var(--card);
      border: 1.5px solid var(--link);
      color: var(--link);
      padding: 0.3rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      font-weight: bold;
    }

    #viewToggle button.active {
      background: var(--link);
      color: var(--bg);
    }

    /* Search and filters */
    #searchInput {
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      border: 1.5px solid var(--link);
      background: var(--card);
      color: var(--text);
      min-width: 220px;
    }

    #filterDifficulty {
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      border: 1.5px solid var(--link);
      background: var(--card);
      color: var(--text);
      cursor: pointer;
    }

    /* Projects container grid/list styles */
    .projects.grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      padding: 2rem 1rem;
      max-width: 1200px;
      margin: auto;
    }

    .projects.list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 2rem 1rem;
      max-width: 900px;
      margin: auto;
    }

    .project-card {
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 1rem;
      transition: 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: default;
    }

    .project-card:hover {
      transform: scale(1.03);
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }

    /* In list view, layout changes */
    .projects.list .project-card {
      flex-direction: row;
      align-items: flex-start;
      padding: 1rem;
      gap: 1rem;
    }

    .projects.list .project-card img {
      width: 180px;
      height: 100px;
      border-radius: 8px;
      flex-shrink: 0;
    }

    /* In grid view, image fills width */
    .projects.grid .project-card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .project-card h3 {
      margin: 0.2rem 0;
      text-align: center;
      flex-shrink: 0;
    }

    /* Title aligned left in list view */
    .projects.list .project-card h3 {
      text-align: left;
    }

    .project-card p {
      font-size: 0.9rem;
      opacity: 0.8;
      text-align: center;
      margin: 0.25rem 0;
    }

    /* Description left aligned in list view */
    .projects.list .project-card p {
      text-align: left;
    }

    .project-card a {
      color: var(--link);
      text-decoration: none;
      font-weight: bold;
      margin-top: 0.5rem;
      user-select: none;
    }

    /* Tags & difficulty styling */
    .tags {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    /* Left aligned in list */
    .projects.list .tags {
      justify-content: flex-start;
    }

    .tag {
      background: rgba(255, 255, 255, 0.1);
      padding: 4px 10px;
      font-size: 0.75rem;
      border-radius: 4px;
      text-transform: uppercase;
      color: var(--link);
      font-weight: bold;
      user-select: none;
    }

    .difficulty {
      display: inline-block;
      font-size: 0.75rem;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 4px;
      margin-top: 4px;
      background: rgba(255,255,255,0.1);
      color: gold;
      user-select: none;
    }

    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.9rem;
      opacity: 0.6;
    }

    /* Pagination styles */
    #pagination {
      max-width: 1200px;
      margin: 1rem auto 3rem auto;
      display: flex;
      justify-content: center;
      gap: 1rem;
      user-select: none;
    }

    #pagination button {
      background: var(--card);
      border: 1.5px solid var(--link);
      color: var(--link);
      padding: 0.3rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      min-width: 50px;
    }

    #pagination button:disabled {
      opacity: 0.3;
      cursor: default;
    }
  </style>
</head>
<body data-theme="dark">
  <header>
    <h1>TechnopDive</h1>
    <p>Game Developer & HTML5 Projects</p>
    <button class="toggle" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>
  </header>

  <div id="controls" aria-label="Project controls">
    <div id="viewToggle" role="group" aria-label="Toggle grid or list view">
      <button id="btnGrid" class="active" aria-pressed="true" title="Grid View">Grid</button>
      <button id="btnList" aria-pressed="false" title="List View">List</button>
    </div>

    <input type="search" id="searchInput" placeholder="Search by tag or name‚Ä¶" aria-label="Search projects by tag or name" />

    <select id="filterDifficulty" aria-label="Filter projects by difficulty">
      <option value="">All Difficulty</option>
      <option value="Easy">Easy</option>
      <option value="Medium">Medium</option>
      <option value="Hard">Hard</option>
    </select>
  </div>

  <section class="projects grid" id="projects" aria-live="polite" aria-busy="true">
    <p>Loading projects...</p>
  </section>

  <nav id="pagination" aria-label="Project pagination" role="navigation" style="display:none;">
    <button id="prevPage" disabled aria-disabled="true" aria-label="Previous page">‚Üê Prev</button>
    <span id="pageInfo" aria-live="polite" aria-atomic="true"></span>
    <button id="nextPage" disabled aria-disabled="true" aria-label="Next page">Next ‚Üí</button>
  </nav>

  <footer>
    &copy; 2025 TechnopDive |
    <a href="https://github.com/thechnopdive1169/myArchive" target="_blank" rel="noopener noreferrer">GitHub Repo</a>
  </footer>

<script>
  const projectsContainer = document.getElementById('projects');
  const searchInput = document.getElementById('searchInput');
  const filterDifficulty = document.getElementById('filterDifficulty');
  const btnGrid = document.getElementById('btnGrid');
  const btnList = document.getElementById('btnList');
  const pagination = document.getElementById('pagination');
  const prevPageBtn = document.getElementById('prevPage');
  const nextPageBtn = document.getElementById('nextPage');
  const pageInfo = document.getElementById('pageInfo');

  let allProjects = [];  // Store all loaded projects
  let filteredProjects = [];
  let currentPage = 1;
  const projectsPerPage = 10;
  let currentView = 'grid'; // 'grid' or 'list'

  async function loadProjects() {
    projectsContainer.setAttribute('aria-busy', 'true');
    try {
      const repo = 'thechnopdive1169/myArchive';

      let projectMeta = {};
      try {
        const metaRes = await fetch('project-data.json');
        if (metaRes.ok) {
          projectMeta = await metaRes.json();
        } else {
          projectMeta = {
            "3D Cube Collector .html": {
              desc: "Collect spinning cubes in a 3D space using mouse controls.",
              tags: ["3D", "Arcade"],
              difficulty: "Easy"
            },
            "3D Snake Battle Royale .html": {
              desc: "Multiplayer snake survival with battle royale mechanics.",
              tags: ["Multiplayer", "Snake"],
              difficulty: "Medium"
            },
            "CYBERPUNK CITY .html": {
              desc: "Walk through a glowing futuristic cyber city in first person.",
              tags: ["FPS", "Sci-Fi"],
              difficulty: "Medium"
            },
            "Dominion of Otherworldly Monsters .html": {
              desc: "Defend Earth from cosmic creatures in a fast-paced shooter.",
              tags: ["Shooter", "Monsters"],
              difficulty: "Hard"
            },
            "POLICE PURSUIT .html": {
              desc: "Evade the police in a retro-style chase simulator.",
              tags: ["Driving", "Chase"],
              difficulty: "Easy"
            }
          };
        }
      } catch (err) {
        console.warn('Failed to load project-data.json, using fallback metadata.');
        projectMeta = {};
      }

      const repoRes = await fetch(`https://api.github.com/repos/${repo}/git/trees/main?recursive=1`);
      if (!repoRes.ok) throw new Error('Failed to fetch repo tree');
      const repoTree = await repoRes.json();

      const allFiles = repoTree.tree;
      const htmlFiles = allFiles.filter(item => item.path.endsWith('.html'));

      // Get commit dates in parallel, but rate-limiting might be needed for many files.
      // For demo, keep as is, but in production consider caching.
      const projects = await Promise.all(htmlFiles.map(async (file) => {
        const commitRes = await fetch(`https://api.github.com/repos/${repo}/commits?path=${encodeURIComponent(file.path)}&per_page=1`);
        let date = new Date(0);
        if (commitRes.ok) {
          const commitData = await commitRes.json();
          date = new Date(commitData[0]?.commit?.committer?.date || 0);
        }
        return { path: file.path, name: file.path.split('/').pop(), date };
      }));

      projects.sort((a, b) => b.date - a.date);

      // Map projects with metadata for filtering/searching
      allProjects = projects.map(project => {
        const name = project.name;
        const shortName = name.replace('.html', '');
        const meta = projectMeta[name] || {};
        return {
          path: project.path,
          name: shortName,
          desc: meta.desc || "No description yet.",
          tags: meta.tags ? meta.tags.map(t => t.toLowerCase()) : [],
          difficulty: meta.difficulty || "",
          date: project.date,
        };
      });

      // Initially filter and render
      applyFilters();

    } catch (err) {
      projectsContainer.innerHTML = '<p>Error loading projects.</p>';
      console.error(err);
    }
    projectsContainer.setAttribute('aria-busy', 'false');
  }

  // Render projects for current page & view
  function renderProjects() {
    projectsContainer.innerHTML = '';
    if (filteredProjects.length === 0) {
      projectsContainer.innerHTML = '<p>No projects match your criteria.</p>';
      pagination.style.display = 'none';
      return;
    }

    pagination.style.display = 'flex';

    // Calculate pagination
    const totalPages = Math.ceil(filteredProjects.length / projectsPerPage);
    if(currentPage > totalPages) currentPage = totalPages;
    if(currentPage < 1) currentPage = 1;

    const startIdx = (currentPage - 1) * projectsPerPage;
    const endIdx = startIdx + projectsPerPage;
    const projectsToShow = filteredProjects.slice(startIdx, endIdx);

    // Set container class for grid/list
    projectsContainer.className = `projects ${currentView}`;

    // Build project cards
    projectsToShow.forEach(project => {
      const tagHTML = project.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
      const difficultyHTML = project.difficulty ? `<div class="difficulty">‚≠ê ${project.difficulty}</div>` : '';
      const lastUpdated = project.date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
      const thumb = `thumbnails/${project.name}.jpg`;

      const card = document.createElement('div');
      card.className = 'project-card';
      card.innerHTML = `
        <img src="${thumb}" alt="${project.name}" onerror="this.src='https://via.placeholder.com/400x160?text=${encodeURIComponent(project.name)}'">
        <div style="flex:1; display:flex; flex-direction: column;">
          <h3>${project.name}</h3>
          <p>${project.desc}</p>
          ${difficultyHTML}
          <div class="tags">${tagHTML}</div>
          <p style="margin-top:0.5rem;font-size:0.8rem;opacity:0.6;">Last updated: ${lastUpdated}</p>
          <a href="${project.path}">Open Project</a>
        </div>
      `;

      projectsContainer.appendChild(card);
    });

    // Update pagination controls
    pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
    prevPageBtn.disabled = currentPage <= 1;
    prevPageBtn.setAttribute('aria-disabled', prevPageBtn.disabled);
    nextPageBtn.disabled = currentPage >= totalPages;
    nextPageBtn.setAttribute('aria-disabled', nextPageBtn.disabled);
  }

  // Apply search and filter then render
  function applyFilters() {
    const searchTerm = searchInput.value.trim().toLowerCase();
    const diffFilter = filterDifficulty.value;

    filteredProjects = allProjects.filter(project => {
      // Search matches name or any tag
      const matchesSearch = searchTerm === '' ||
        project.name.toLowerCase().includes(searchTerm) ||
        project.tags.some(tag => tag.includes(searchTerm));

      // Difficulty filter
      const matchesDiff = diffFilter === '' || project.difficulty.toLowerCase() === diffFilter.toLowerCase();

      return matchesSearch && matchesDiff;
    });

    currentPage = 1;
    renderProjects();
  }

  // Event listeners

  searchInput.addEventListener('input', () => {
    applyFilters();
  });

  filterDifficulty.addEventListener('change', () => {
    applyFilters();
  });

  btnGrid.addEventListener('click', () => {
    if (currentView !== 'grid') {
      currentView = 'grid';
      btnGrid.classList.add('active');
      btnGrid.setAttribute('aria-pressed', 'true');
      btnList.classList.remove('active');
      btnList.setAttribute('aria-pressed', 'false');
      renderProjects();
    }
  });

  btnList.addEventListener('click', () => {
    if (currentView !== 'list') {
      currentView = 'list';
      btnList.classList.add('active');
      btnList.setAttribute('aria-pressed', 'true');
      btnGrid.classList.remove('active');
      btnGrid.setAttribute('aria-pressed', 'false');
      renderProjects();
    }
  });

  prevPageBtn.addEventListener('click', () => {
    if (currentPage > 1) {
      currentPage--;
      renderProjects();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });

  nextPageBtn.addEventListener('click', () => {
    const totalPages = Math.ceil(filteredProjects.length / projectsPerPage);
    if (currentPage < totalPages) {
      currentPage++;
      renderProjects();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });

  function toggleTheme() {
    const body = document.body;
    const current = body.getAttribute('data-theme');
    const next = current === 'light' ? 'dark' : 'light';
    body.setAttribute('data-theme', next);
  }

  // Initial load
  loadProjects();
</script>
</body>
</html>
